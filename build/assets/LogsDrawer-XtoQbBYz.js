import{j as r,Y as M,r as d,z as P,R as A,u,e as O,B as s,T as c,aT as U,i as W,f as Z,a2 as _,I as $}from"./index-tWVfh1a_.js";import{a as F,d as G,f as N,n as Y}from"./ProgressLogs-BwRPUwL2.js";import{M as q}from"./MessageCard-BW_wKbJJ.js";import{S as J}from"./SwipeableDrawer-BEL-t-Lb.js";import{D as K}from"./Divider-0_Mpg1Be.js";import{A as Q}from"./Avatar-DYK8RM-C.js";import{I as X}from"./InputBase-7pV38TnQ.js";import{B as p}from"./Badge-ekxejyFm.js";function D(t){return r.jsxs(M,{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t,children:[r.jsx("g",{"clip-path":"url(#clip0_10734_13859)",children:r.jsx("path",{d:"M12.6667 2.01467C12.6667 2.00933 12.6667 2.00533 12.6667 2V0.666667C12.6667 0.489856 12.5964 0.320286 12.4714 0.195262C12.3464 0.0702379 12.1768 0 12 0C11.8232 0 11.6536 0.0702379 11.5286 0.195262C11.4036 0.320286 11.3333 0.489856 11.3333 0.666667V1.4C11.1139 1.35544 10.8906 1.33311 10.6667 1.33333H10V0.666667C10 0.489856 9.92976 0.320286 9.80474 0.195262C9.67971 0.0702379 9.51014 0 9.33333 0C9.15652 0 8.98695 0.0702379 8.86193 0.195262C8.73691 0.320286 8.66667 0.489856 8.66667 0.666667V1.33333H7.33333V0.666667C7.33333 0.489856 7.2631 0.320286 7.13807 0.195262C7.01305 0.0702379 6.84348 0 6.66667 0C6.48986 0 6.32029 0.0702379 6.19526 0.195262C6.07024 0.320286 6 0.489856 6 0.666667V1.33333H5.33333C5.10944 1.33311 4.88609 1.35544 4.66667 1.4V0.666667C4.66667 0.489856 4.59643 0.320286 4.4714 0.195262C4.34638 0.0702379 4.17681 0 4 0C3.82319 0 3.65362 0.0702379 3.5286 0.195262C3.40357 0.320286 3.33333 0.489856 3.33333 0.666667V2V2.01467C2.92052 2.32292 2.58513 2.72303 2.35371 3.18332C2.12229 3.64362 2.00119 4.15147 2 4.66667V12.6667C2.00106 13.5504 2.35259 14.3976 2.97748 15.0225C3.60237 15.6474 4.4496 15.9989 5.33333 16H10.6667C11.5504 15.9989 12.3976 15.6474 13.0225 15.0225C13.6474 14.3976 13.9989 13.5504 14 12.6667V4.66667C13.9988 4.15147 13.8777 3.64362 13.6463 3.18332C13.4149 2.72303 13.0795 2.32292 12.6667 2.01467ZM8 11.3333H5.33333C5.15652 11.3333 4.98695 11.2631 4.86193 11.1381C4.7369 11.013 4.66667 10.8435 4.66667 10.6667C4.66667 10.4899 4.7369 10.3203 4.86193 10.1953C4.98695 10.0702 5.15652 10 5.33333 10H8C8.17681 10 8.34638 10.0702 8.4714 10.1953C8.59643 10.3203 8.66667 10.4899 8.66667 10.6667C8.66667 10.8435 8.59643 11.013 8.4714 11.1381C8.34638 11.2631 8.17681 11.3333 8 11.3333ZM10.6667 8.66667H5.33333C5.15652 8.66667 4.98695 8.59643 4.86193 8.47141C4.7369 8.34638 4.66667 8.17681 4.66667 8C4.66667 7.82319 4.7369 7.65362 4.86193 7.5286C4.98695 7.40357 5.15652 7.33333 5.33333 7.33333H10.6667C10.8435 7.33333 11.013 7.40357 11.1381 7.5286C11.2631 7.65362 11.3333 7.82319 11.3333 8C11.3333 8.17681 11.2631 8.34638 11.1381 8.47141C11.013 8.59643 10.8435 8.66667 10.6667 8.66667ZM10.6667 6H5.33333C5.15652 6 4.98695 5.92976 4.86193 5.80474C4.7369 5.67971 4.66667 5.51014 4.66667 5.33333C4.66667 5.15652 4.7369 4.98695 4.86193 4.86193C4.98695 4.7369 5.15652 4.66667 5.33333 4.66667H10.6667C10.8435 4.66667 11.013 4.7369 11.1381 4.86193C11.2631 4.98695 11.3333 5.15652 11.3333 5.33333C11.3333 5.51014 11.2631 5.67971 11.1381 5.80474C11.013 5.92976 10.8435 6 10.6667 6Z",fill:"#2B4057"})}),r.jsx("defs",{children:r.jsx("clipPath",{id:"clip0_10734_13859",children:r.jsx("rect",{width:"16",height:"16",fill:"white"})})})]})}function ee(t,te){var S,B;const[y,g]=d.useState(t.openLogs),[x,m]=d.useState(""),[T,w]=d.useState(!0),[o,h]=P(`logs-upload-${t.day}-${t.week}-${t.exerciseIndex}`,[]);P(`logs-upload-${t.orderId}`,[]);const i=A.useRef(null),n=u(e=>e.Profile),j=u(e=>e.ProgressLogs.logs),I=u(e=>e.Sync.media);let C=j.filter(e=>e.isUploaded==!1&&e.orderId==t.orderId&&e.day==t.day&&e.week==t.week&&e.exercise==t.exerciseIndex);const R=e=>a=>{a&&a.type==="keydown"&&(a.key==="Tab"||a.key==="Shift")||(!e&&t.onClose&&t.onClose(),g(e))},V=O(),k=d.useRef(null);d.useEffect(()=>{C.map(e=>{Object.values(I).filter(l=>l.orderId==e.orderId&&e.day==l.day&&e.week==l.week&&l.exercise==e.exercise).length||F({_id:e._id,exercise:e.exercise,orderId:e.orderId,message:e.message,day:e.day,week:e.week,media:e.media}).then(l=>{G(e._id),h([...o,e]),t.setLatestLog&&t.setLatestLog(l?{...l,createdBy:e.createdBy,media:e.media}:{}),t.setLogCount&&t.setLogCount(o.length+1),i.current&&(i.current.scrollTop=i.current.scrollHeight)})})},[j]);const z=()=>{Y({_id:_().toString(),exercise:t.exerciseIndex,orderId:t.orderId,message:x,day:t.day,week:t.week,name:n.name,profilePic:n.profilePic,type:n.type,createdBy:n,isUploaded:!1}),m(""),i.current&&(i.current.scrollTop=i.current.scrollHeight)},E=e=>{h(o.filter(a=>a._id!==e))},L=()=>{N({id:t.orderId,week:t.week,day:t.day,exercise:t.exerciseIndex}).then(e=>{t.setLatestLog(e.length?e[e.length-1]:{}),w(!1),h(e),t.setLogCount&&t.setLogCount(e.length),i.current&&(i.current.scrollTop=i.current.scrollHeight)}).catch(e=>{w(!1)})};return d.useEffect(()=>{L()},[t.orderId,t.week,t.day,t.exerciseIndex]),d.useEffect(()=>{setTimeout(()=>{var e;(e=i.current)!=null&&e.scrollHeight&&(i.current.scrollTop=i.current.scrollHeight)},100)},[o,y,i]),d.useEffect(()=>{g(t.openLogs)},[t.openLogs]),r.jsxs("div",{children:[r.jsxs(J,{anchor:"bottom",PaperProps:{style:{backgroundColor:"#F9FAFD",boxShadow:"none",borderRadius:"8px 8px 0 0",padding:"20px",minHeight:"90vh",maxHeight:"90vh"}},disableBackdropTransition:!0,open:y,onClose:()=>{t.onClose()},onOpen:R(!0),children:[r.jsxs(s,{display:"flex",alignItems:"center",children:[r.jsx(D,{sx:{fontSize:20,mr:.5}}),r.jsx(c,{variant:"h2",children:"Training Log"})]}),r.jsx(s,{mt:2,ml:0,children:r.jsxs(c,{component:"span",sx:{fontWeight:"500",textTransform:"capitalize"},children:["Exercise ",t.exerciseIndex+1,":"," ",r.jsx(c,{component:"span",color:"text.secondary",children:((B=(S=t.Exercise)==null?void 0:S[t.exerciseIndex])==null?void 0:B.title)||(t==null?void 0:t.title)})]})}),r.jsx(K,{sx:{my:2}}),r.jsx(s,{height:"100%",display:"flex",flexDirection:"column",flexGrow:1,overflow:"auto",ref:i,children:r.jsx(s,{display:"flex",flexGrow:1,flexDirection:"column",children:[...o,...C].length>0?[...o,...C].map((e,a)=>{var b,H,v;let l=Object.values(I).filter(f=>f.orderId==t.orderId&&t.day==f.day&&t.week==f.week&&f.exercise==t.exerciseIndex&&f._id==e._id);return r.jsx(q,{fetchAllLogs:L,_id:e._id,onDeleteLog:E,name:(b=e.createdBy)==null?void 0:b.name,profilePic:(H=e==null?void 0:e.createdBy)==null?void 0:H.profilePic,createdBy:(v=e.createdBy)==null?void 0:v._id,createdAt:e.createdAt,message:e.message,media:e.media,type:e.type,pendingSync:l},a)}):r.jsx(s,{display:"flex",flexGrow:1,justifyContent:"center",alignItems:"center",children:T?r.jsx(U,{}):r.jsx(c,{color:"text.secondary",children:"No comments"})})})}),r.jsxs(s,{display:"flex",gap:1,alignItems:"center",my:2,children:[r.jsx(Q,{src:n.profilePic,sx:{height:32,width:32},size:"large"}),r.jsx(c,{variant:"subtitle1",sx:{textTransform:"capitalize"},children:n.name})]}),r.jsxs(s,{width:"100%",sx:{border:"1.5px solid #C3CBD9",borderRadius:"8px",p:2,backgroundColor:"#fff"},children:[r.jsxs(s,{children:[r.jsx(X,{multiline:!0,fullWidth:!0,minRows:3,maxRows:5,value:x,onChange:e=>m(e.target.value),sx:{width:"100%",border:"none"},placeholder:"Write something"}),r.jsxs(s,{width:"100%",display:"flex",alignItems:"center",justifyContent:"flex-end",children:[r.jsx(W,{icon:"fluent:image-add-20-regular",onClick:()=>{var e;(e=k.current)==null||e.click()},sx:{fontSize:28,color:"text.primary"}}),r.jsx(Z,{disabled:!x,onClick:z,sx:{ml:2,fontSize:16,color:x?"primary.main":"text.secondary"},children:"Post"})]})]}),r.jsx("input",{type:"file",ref:k,style:{display:"none"},accept:"image/* ,video/*",onChange:e=>V("/media/add",{state:{file:e.target.files,orderId:t.orderId,Profile:n,_id:_().toString(),exercise:t.exerciseIndex,day:t.day,week:t.week,comment:x,name:n.name,profilePic:n.profilePic,type:n.type,createdBy:n}})})]})]}),r.jsxs("div",{onClick:()=>{g(!0)},children:[" ",t.children?t.children:r.jsxs($,{sx:{display:"flex",flexDirection:"column"},onClick:t.onClickLog||null,children:[r.jsx(p,{badgeContent:o.length,color:"primary",children:r.jsx(D,{sx:{fontSize:38,color:"#fff"}})}),r.jsx(c,{sx:{color:"#fff",fontWeight:"bold",opacity:1,fontSize:14,mt:.5},children:"Training log"})]})]})]})}const ce=d.forwardRef(ee);export{D as L,ce as a};
