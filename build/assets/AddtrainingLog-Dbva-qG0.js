import{a as N,d as E,r as d,z,e as $,j as e,s as y,S as H,B as n,I as j,T as L,p as _,c as x,i as f,n as W,o as b,bg as U}from"./index-tWVfh1a_.js";import{P as Y}from"./Page-D7TsOLpr.js";import{I as T}from"./ImageWithFallback-C5zvNA0Z.js";import{n as q,b as G}from"./ProgressLogs-BwRPUwL2.js";import{c as P,e as w}from"./sync-CFO_F30W.js";import{d as J,g as K}from"./convertToLink-D3DGDIAW.js";import{R as Q}from"./index-DmwG6s5l.js";import{C as X}from"./CloseRedIcon-DBKQk9yY.js";import{R as Z}from"./ReactPlayerWithFallback-Zm03AunA.js";import{A as ee}from"./ArrowLeft-lA8HnlgG.js";import{g as B}from"./getFileFormat-Bssviiun.js";import{I as te}from"./InputBase-7pV38TnQ.js";import"./ReactPlayer-B1HYrz8S.js";import"./memoize-one.esm-Cbrq43TT.js";import"./Image-B5TKYvdb.js";import"./useFormControl-BEzaUW9U.js";const oe=y("div")(({theme:i})=>({backgroundColor:"#3b579d"}));y("div")(({theme:i})=>({background:"linear-gradient(180deg, rgba(43, 64, 87, 0) 0%, rgba(43, 64, 87, 0.7) 89.84%)",position:"absolute",bottom:0,left:0,zIndex:1e3,padding:"12px 24px 24px",width:"100%"}));const ie=y("div")(({theme:i})=>({position:"absolute",top:0,left:0,padding:"20px",width:"100%",display:"flex",alignItems:"center"}));function Le(i){var C;const s=N(),{state:t}=E(),l=d.useRef();z(`logs-upload-${t.orderId}`,[]);const h=$(),[ae,le]=d.useState(!0),[r,v]=d.useState((t==null?void 0:t.index)||0),[o,I]=d.useState(t.file?[...t.file]:[]),k={slide:{minHeight:"100vh",color:"#fff"},slide3:{background:"#000"}},F=()=>{var a;q({_id:t._id,exercise:t.exercise,orderId:t.orderId,message:(a=l==null?void 0:l.current)==null?void 0:a.value,day:t.day,week:t.week,name:t.name,profilePic:t.profilePic,type:t.type,createdBy:t.Profile,isUploaded:!1,media:[]}),S()},M=a=>new Promise((c,A)=>{const m=a;let g=new Date().getTime();new FormData().append("file",m);let D=W.post(`${b.protocol}${b.baseUrl}${b.getMediaUploadSignedUrl}`,{name:m.name,type:"application/octet-stream"}).then(u=>{const R=U.CancelToken.source();s(P(g,{source:R,...t})),c(),U.put(u.data,m,{cancelToken:R.token,headers:{"Content-Type":"application/octet-stream"},onUploadProgress:p=>{s(P(g,{upload:D,progress:Math.round(p.loaded/p.total*100),...t}))}}).then(p=>{G(t._id,u.data.split("?")[0]),s(w(g))}).catch(p=>{A(),s(w(g))})}).catch(u=>{console.log(u),s(w(g)),s(x({message:"Error uploading video",type:"error"}))})}),S=async()=>{s(x({loading:!0}));for(const a of[...o].filter(c=>typeof c!="string"))await M(a);s(x({loading:!1})),h(-1)},V=a=>{I([...o,...a.target.files])},O=a=>{if(r>0)v(r-1);else return h(-1);let c=[...o];c.splice(a,1),I(c)};return e.jsxs(Y,{title:" Simplified Online Fitness Training ",children:[e.jsx("input",{type:"file",accept:"image/* , video/*",style:{display:"none"},id:"media-add-new-video",onChange:V}),e.jsx(oe,{children:e.jsxs(H,{children:[e.jsx("div",{style:Object.assign({},k.slide,k.slide3),children:e.jsxs(n,{position:"relative",children:[" ",e.jsx(n,{style:{width:"100vw",height:"100vh",position:"relative",display:"flex",justifyContent:"center",alignItems:"center"},children:B(((C=o==null?void 0:o[r])==null?void 0:C.name)||(o==null?void 0:o[r]))=="video"?e.jsx(Z,{url:typeof(o==null?void 0:o[r])=="string"?J(o==null?void 0:o[r]):URL.createObjectURL(o[r]),loop:!0,raw:o==null?void 0:o[r],controls:!1,responsive:!0,playsinline:!0,playing:!0,width:"100vw",height:"auto",style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100vw",height:"100vh","& video":{}}}):e.jsx("img",{src:typeof(o==null?void 0:o[r])=="string"?o==null?void 0:o[r]:URL.createObjectURL(o[r]),width:"100%",height:"auto",style:{maxHeight:"100vh"}})}),e.jsx(n,{position:"absolute",zIndex:1e3,width:"100vw",height:"10vh",top:0,children:e.jsxs(ie,{children:[e.jsx(j,{onClick:()=>h(-1),sx:{color:"common.white"},children:e.jsx(ee,{})}),"Â ",e.jsxs(L,{variant:"subtitle1",color:"common.white",children:[i.view?"View":"Add"," Media"]})]})})]})}),e.jsxs(n,{zIndex:100,position:"absolute",bottom:0,px:2,pb:4,width:"100%",style:{background:"linear-gradient(180deg, rgba(0,0,0,0) 0%,  rgba(0,0,0,1) 100%)"},children:[e.jsx(se,{videos:o,setCurrentIndex:v,currentIndex:r,mode:i.mode,removeVideo:O}),i.mode=="view"?e.jsx(n,{sx:{background:"#13202F",borderRadius:1,mb:3,px:2,color:"white",py:1},children:t.comment||"No comments"}):e.jsx(te,{sx:{background:"#13202F",border:"1.5px solid white",borderRadius:1,mb:3,px:2,color:"white",minHeight:48},fullWidth:!0,placeholder:"Add comment...",multiline:!0,defaultValue:t.comment,inputRef:l,maxRows:5}),i.mode=="view"?"":e.jsxs(n,{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(L,{color:"common.white",children:"1 Media selected"}),e.jsx(_,{variant:"contained",sx:{px:4},onClick:F,children:"Post"})]})]})]})})]})}const se=i=>{var s;return e.jsx(n,{overflow:"auto",children:e.jsxs(n,{display:"flex",my:2,children:[i.mode=="view"?"":e.jsx(n,{onClick:()=>document.getElementById("media-add-new-video").click(),mx:1,height:66,width:66,display:"flex",flexDirection:"row",alignItems:"center",overflowY:"auto",borderRadius:1,bgcolor:"rgba(217, 217, 217, 0.5)",border:2,borderColor:"#fff",children:e.jsxs(n,{ml:1.1,children:[e.jsx(j,{children:e.jsx(f,{icon:"ant-design:plus-outlined",width:28,height:28,color:"common.white"})}),e.jsx(n,{borderRadius:1,overflow:"hidden"})]})}),(s=i.videos)==null?void 0:s.map((t,l)=>e.jsx(n,{mx:1,height:"66px",width:"66px",display:"flex",flexDirection:"row",alignItems:"center",overflowY:"auto",onClick:()=>i.setCurrentIndex(l),children:e.jsxs(n,{position:"relative",children:[i.mode=="view"?"":e.jsx(j,{style:{position:"absolute",top:-16,right:-16,zIndex:100},children:i.currentIndex==l?e.jsx(X,{onClick:h=>{h.stopPropagation(),i.removeVideo(l)}}):null}),e.jsx(n,{borderRadius:1,border:2,borderColor:i.currentIndex==l?"#fff":"rgba(255, 255, 255, 0)",position:"relative",overflow:"hidden",bgcolor:"none",children:B((t==null?void 0:t.name)||t)=="video"?e.jsxs(n,{borderRadius:1,overflow:"hidden",height:66,width:66,children:[typeof t=="string"?e.jsx(re,{link:t}):e.jsx(ne,{component:Q,fileName:t.name,url:URL.createObjectURL(t),loop:!0,controls:!1,autoPlay:!0,responsive:!0,playsinline:!0,playing:!1,width:"100%",height:"100%",style:{display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"20px",width:"100%",height:"100%","& video":{borderRadius:"20px"}}}),e.jsx("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:0,height:"100%",width:"100%",display:"flex",justifyContent:"flex-start",alignItems:"flex-end",padding:8,background:"rgba(0,0,0,0.15)"},children:e.jsx(f,{icon:"majesticons:video",color:"common.white",width:18,height:18})})]}):e.jsxs(n,{borderRadius:1,overflow:"hidden",height:66,width:66,children:[e.jsx(T,{variant:"rounded",style:{width:"100%",height:"100%",objectFit:"cover"},src:typeof t=="string"?t:URL.createObjectURL(t)}),e.jsx("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:0,height:"100%",width:"100%",display:"flex",justifyContent:"flex-start",alignItems:"flex-end",padding:8,background:"rgba(0,0,0,0.15)"},children:e.jsx(f,{icon:"bi:image-fill",color:"common.white",width:18,height:18})})]})})]})}))]})})},ne=d.memo(i=>{let s=i.component;return e.jsx(s,{...i})},(i,s)=>i.fileName==s.fileName),re=i=>{const[s,t]=d.useState("");return d.useEffect(()=>{t(K(i.link))},[i.link]),e.jsx(T,{onClick:i.onClick,variant:"rounded",style:{width:"100%",height:"100%",objectFit:"cover"},src:s||"/images/instructor/exerciseImage.png"})};export{Le as default};
