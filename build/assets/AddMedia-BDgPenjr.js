import{a as xt,d as bt,r as h,e as jt,U as vt,u as ot,j as e,s as B,S as wt,B as d,I as T,T as I,p as K,_ as Ct,c as M,cb as kt,i as D,n as It,o as U,bg as Q}from"./index-tWVfh1a_.js";import{P as Mt}from"./Page-D7TsOLpr.js";import{I as R}from"./ImageWithFallback-C5zvNA0Z.js";import{W as St}from"./exerciseCardBottomSelection-C6_Gz6HQ.js";import{C as Rt}from"./Circular-CdB5voB0.js";import{g as S}from"./getFileFormat-Bssviiun.js";import{u as X,d as P}from"./sync-CFO_F30W.js";import{M as Et}from"./bottomDrawer-DMtCRIBf.js";import{a as Z,c as Dt,b as Ut}from"./convertToLink-D3DGDIAW.js";import{M as tt}from"./Model-Bs8FCq2d.js";import{R as Pt}from"./index-DmwG6s5l.js";import{R as et}from"./ReactPlayerWithFallback-Zm03AunA.js";import{A as Tt}from"./ArrowLeft-lA8HnlgG.js";import{C as Bt}from"./CloseRedIcon-DBKQk9yY.js";import{S as Ft}from"./Slider-DuuEQ67Z.js";import{I as Vt}from"./InputBase-7pV38TnQ.js";import"./LibrarySelector-BSF-MZAA.js";import"./Workout-eTy7zLdJ.js";import"./More-BqGLUvK6.js";import"./edit-DiWhq57E.js";import"./Delete-fvKHvwYo.js";import"./search-qBW2W_DU.js";import"./Checkbox-5Xdp7ogM.js";import"./SwitchBase-Bs2jeD_h.js";import"./useFormControl-BEzaUW9U.js";import"./useControlled-DiwPEJyR.js";import"./Divider-0_Mpg1Be.js";import"./dividerClasses-ClaZwgHh.js";import"./ReactPlayer-B1HYrz8S.js";import"./memoize-one.esm-Cbrq43TT.js";import"./YouTube-BrIpEXBG.js";import"./Dumbell-LvyqFLuX.js";import"./MenuItem-BRbCqEYh.js";import"./ListContext-BQPXTeBj.js";import"./Share-D8xeKOeo.js";import"./CopyLink-DOxHVA9c.js";import"./moment-G82_0lEo.js";import"./Header-C-6_pkkN.js";import"./footer-BJqjd-0J.js";import"./Footer-BU_S36Uf.js";import"./TextField-cyeEFY3i.js";import"./OutlinedInput-D3YoqtXT.js";import"./Popover-COOgvQR_.js";import"./isMuiElement-CENM59Ut.js";import"./InputAdornment-DiI_gVyu.js";import"./Tabs-Cs2QRRdO.js";import"./DB-D1UkOgeB.js";import"./SwipeableDrawer-BEL-t-Lb.js";import"./Image-B5TKYvdb.js";import"./Close-0gM9I1tD.js";import"./TabContext-CXvaiNSx.js";import"./TabPanel-D7TYthF4.js";const Lt=B("div")(({theme:l})=>({backgroundColor:"#3b579d"})),zt=B("div")(({theme:l})=>({background:"linear-gradient(180deg, rgba(43, 64, 87, 0) 0%, rgba(43, 64, 87, 0.7) 89.84%)",position:"absolute",bottom:0,left:0,zIndex:1e3,padding:"12px 24px 24px",width:"100%"})),At=B("div")(({theme:l})=>({position:"absolute",top:0,left:0,padding:"20px",width:"100%",display:"flex",alignItems:"center"}));function $e(l){var z,A,O,N,W,$,H,Y,q,_;const u=xt(),{state:a}=bt(),f=h.useRef(null),y=jt(),[s,m]=h.useState(0),[p,x]=h.useState(0),[it,v]=h.useState(!0),[b,E]=vt(),[F,nt]=h.useState(!0),[lt,$t]=h.useState(!0),at=ot(o=>o.Library.videos);let r=b.Exercise[(a==null?void 0:a.index)||0];console.log(r);const[i,V]=h.useState(0),[t,j]=h.useState(a.file?[...a.file]:r==null?void 0:r.media),rt=o=>{let n=[...t];n[i]&&(n[i].triggerMuscle=o),j(n)},L={slide:{minHeight:"100vh",color:"#fff"},slide3:{background:"#000"}},w=(o,n)=>{let c={...b};c.Exercise[n]={...c.Exercise[n],...o},E(c)},st=async o=>{const n=o;let c=new Date().getTime();new FormData().append("file",n);let C=It.post(`${U.protocol}${U.baseUrl}${U.getSignedUrl}`,{title:n.title||(r==null?void 0:r.title)||n.name,name:n.name,type:"application/octet-stream"}).then(g=>{const J=Q.CancelToken.source();u(X(c,{source:J,...a})),Q.put(g.data,n,{cancelToken:J.token,headers:{"Content-Type":"application/octet-stream"},onUploadProgress:k=>{u(X(c,{upload:C,progress:Math.round(k.loaded/k.total*100),...a}))}}).then(k=>{w({media:b.Exercise[a.index].media?[...b.Exercise[a.index].media,{file:g.data.split("?")[0],title:n.title||n.name,triggerMuscle:n.triggerMuscle||[]}]:[{file:g.data.split("?")[0],title:n.title||n.name,triggerMuscle:n.triggerMuscle||[]}]},a.index),u(P(c))}).catch(k=>{u(P(c))})}).catch(g=>{console.log(g),u(P(c)),u(M({message:"Error uploading video",type:"error"}))})},dt=o=>{var C;let n={...b},c=[...(C=n.Exercise[a.index])!=null&&C.media?n.Exercise[a.index].media:[],...o.map(g=>({file:g.media,type:g.type,title:g.title,triggerMuscle:g.triggerMuscle}))],G=Ct.union(n.Exercise[a.index].triggerMuscle,...o.map(g=>g.triggerMuscle));j([...t,...o.map(g=>({file:g.media,type:g.type,title:g.title,triggerMuscle:g.triggerMuscle}))]),n.Exercise[a.index]={...n.Exercise[a.index],media:c,triggerMuscle:G},E(n)},ct=async()=>{if(u(M({loading:!0})),[...t].filter(o=>!o.file).length==0){let o={...b};o.Exercise[a.index]={...o.Exercise[a.index],media:[...t]},E(o),u(M({loading:!1})),y(-1)}else{for(const o of[...t].filter(n=>!n.file))await st(o);u(M({loading:!1})),y(-1)}},ut=o=>{j([...t,...o.target.files])},gt=o=>{typeof t[o]=="string"?ht(t[o]):i==o&&i&&V(i-1);let n=[...t];n.splice(o,1),j(n)},ht=o=>{u(kt([o.split("https://vimeo.com/")[1]])).then(n=>{w({media:r==null?void 0:r.media.filter(c=>c!==o)},a.index)}).catch(n=>{n.response.status==404&&w({media:r==null?void 0:r.media.filter(c=>c!==o)},a.index)})};h.useEffect(()=>{var o;(((o=r==null?void 0:r.media)==null?void 0:o.length)==0||!(r!=null&&r.media))&&w({triggerMuscle:[]},a.index)},[]);let mt=[...t].filter(o=>!o.file);console.log(t==null?void 0:t[i],"exercise");const pt=h.useMemo(()=>{var o;return(o=t==null?void 0:t[i])!=null&&o.file?Z(t!=null&&t[i]?t[i]:""):t!=null&&t[i]?URL.createObjectURL(t[i]):""},[t,i]),ft=o=>{console.log(o)},yt=(o,n)=>{let c=[...t];c[i]&&(c[i].title=o),j(c)};return e.jsxs(Mt,{title:" Simplified Online Fitness Training ",children:[e.jsx("input",{type:"file",accept:"video/* , image/*",style:{display:"none"},id:"media-add-new-video",onChange:ut}),e.jsx(Lt,{children:e.jsx(wt,{children:e.jsx("div",{style:Object.assign({},L.slide,L.slide3),children:e.jsxs(d,{position:"relative",children:[" ",t!=null&&t[i]&&S(((z=t==null?void 0:t[i])==null?void 0:z.name)||(t==null?void 0:t[i]))=="video"?e.jsx(d,{style:{width:"100vw",height:"100vh",position:"relative",display:"flex",justifyContent:"center",alignItems:"center"},children:t!=null&&t[i]&&typeof((A=t==null?void 0:t[i])==null?void 0:A.file)=="string"?e.jsx(et,{url:Z(t!=null&&t[i]?t[i]:""),raw:t!=null&&t[i]?t[i].file:"",loop:!0,controls:!1,responsive:!0,playsinline:!0,ref:f,playing:it,onProgress:o=>{m(o.playedSeconds)},onDuration:o=>{x(o)},progressInterval:100,width:"100vw",height:"100vh",style:{zIndex:0,display:"flex",justifyContent:"center",alignItems:"center",width:"100vw",height:"100vh","& video":{width:"100vw",height:"100vh"}}}):e.jsx(et,{ref:f,url:pt,loop:!0,controls:!1,responsive:!0,playsinline:!0,playing:!0,width:"100vw",height:"auto",onProgress:o=>{m(o.playedSeconds)},onDuration:o=>{x(o)},progressInterval:100,style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100vw",height:"100vh","& video":{}}})}):t!=null&&t[i]?e.jsx(d,{style:{width:"100vw",height:"100vh",position:"relative",display:"flex",justifyContent:"center",alignItems:"center"},children:t!=null&&t[i]&&typeof(t==null?void 0:t[i].file)=="string"?e.jsx(R,{variant:"rounded",style:{width:"100%",height:"100%",objectFit:"contain"},src:t==null?void 0:t[i].file}):e.jsx(R,{variant:"rounded",style:{width:"100%",height:"100%",objectFit:"contain"},src:URL.createObjectURL(t[i])})}):null,e.jsxs(d,{position:"absolute",zIndex:1e3,width:"100vw",height:"100vh",top:0,onClick:()=>nt(!F),children:[e.jsxs(At,{sx:{justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(d,{display:"flex",alignItems:"center",children:[e.jsx(T,{onClick:()=>y(-1),sx:{color:"common.white"},children:e.jsx(Tt,{})})," ",e.jsxs(I,{variant:"subtitle1",color:"common.white",children:["Exercise ",a.index+1]})]}),(t==null?void 0:t[i])&&((O=t==null?void 0:t[i])==null?void 0:O.type)!="youtube"&&e.jsx(K,{type:"text",disabled:(N=t==null?void 0:t[i])==null?void 0:N.isUploading,sx:{fontSize:16,color:"white",px:0},onClick:o=>{o.stopPropagation(),ft(t==null?void 0:t[i])},children:at.find(o=>{var n;return`https://circled-videos.s3.us-east-1.amazonaws.com/${o.key}`==((n=t==null?void 0:t[i])==null?void 0:n.file)})?"":t!=null&&t[i]&&S(((W=t==null?void 0:t[i])==null?void 0:W.name)||(t==null?void 0:t[i]))=="video"&&!(t!=null&&t[i].isSaved)?($=t==null?void 0:t[i])!=null&&$.isUploading?"Saving to library":"Save to library":""})]}),e.jsx(d,{style:{position:"absolute",top:"50vh",right:0,paddingRight:10}}),l.clientInstructorView&&e.jsx(d,{pr:1,sx:{marginTop:"50vh"},display:"flex",width:"100%",justifyContent:"flex-end",zIndex:2e3,position:"absolute"}),F&&e.jsxs(zt,{style:{display:lt?"block":"none"},onClick:o=>o.stopPropagation(),children:[e.jsx(Et,{setMData:rt,data:[{muscles:((H=t==null?void 0:t[i])==null?void 0:H.triggerMuscle)||[]}],children:e.jsxs(d,{display:"flex",alignItems:"center",children:[e.jsx(tt,{data:[{name:(r==null?void 0:r.title)||"",muscles:((Y=t==null?void 0:t[i])==null?void 0:Y.triggerMuscle)||[],frequency:1}],style:{width:"68px",padding:"5px"},highlightedColors:["#EE3737"]}),e.jsx(tt,{type:"posterior",data:[{name:r==null?void 0:r.title,muscles:((q=t==null?void 0:t[i])==null?void 0:q.triggerMuscle)||[],frequency:1}],style:{width:"68px",padding:"5px"},highlightedColors:["#EE3737"]})]})}),e.jsx(Ot,{videos:t,updateMediaTitle:yt,uploadMediasFromLib:dt,currentExercise:i,setCurrent:o=>{V(o)},state:a,removeVideo:gt}),(t==null?void 0:t[i])&&S(((_=t==null?void 0:t[i])==null?void 0:_.name)||(t==null?void 0:t[i]))=="video"&&e.jsx(d,{children:e.jsx(Ft,{size:"large",min:0,max:p,value:s,onDragStart:o=>{v(!1)},onDragEnd:o=>{v(!0)},onChangeCommitted:(o,n)=>{v(!0)},onChange:(o,n)=>{v(!1),f.current.seekTo(n,"seconds"),m(n)}})}),e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",style:{color:"#959FAB !important"},children:[e.jsxs(d,{display:"flex",alignItems:"center",ml:2,children:[e.jsx(I,{variant:"subtitle1",color:(t==null?void 0:t.length)>0?"common.white":"muted.text",children:(t==null?void 0:t.length)??0}),e.jsx(I,{ml:1,children:"Media uploaded"})]}),e.jsxs(K,{disabled:(t==null?void 0:t.length)==0||!t,variant:"contained",onClick:ct,sx:{height:40,pl:3,pr:3},children:[e.jsx(I,{variant:"body1",color:(t==null?void 0:t.length)>0?"common.white":"muted.text",children:mt.length?"Upload":"Done"})," "]})]})]})]})]})})})})]})}const Ot=l=>{var f,y;const u=ot(s=>Object.values(s.Sync.programs).filter(m=>m.week==l.state.week&&m.day==l.state.day&&m.index==l.state.index)),a=h.useRef(null);return h.useEffect(()=>{var s;console.log("currentExercise",a.current),a.current.value=((s=l.videos[l.currentExercise])==null?void 0:s.title)||null},[l.currentExercise]),e.jsxs(d,{children:[e.jsxs(d,{display:"flex",my:2,pt:2,pb:1,width:"100%",overflow:"auto",children:[e.jsx(St,{title:"Add media",w:l.w,d:l.d,Program:l.plan,onSelection:s=>l.uploadMediasFromLib(s),onUploadNew:()=>document.getElementById("media-add-new-video").click(),children:e.jsx(d,{mx:1,height:66,width:66,display:"flex",flexDirection:"row",alignItems:"center",overflowY:"auto",borderRadius:1,bgcolor:"rgba(217, 217, 217, 0.5)",border:2,borderColor:"#fff",children:e.jsxs(d,{ml:1.1,children:[e.jsx(T,{children:e.jsx(D,{icon:"ant-design:plus-outlined",width:28,height:28,color:"common.white"})}),e.jsx(d,{borderRadius:1,overflow:"hidden"})]})})}),(f=l.videos)==null?void 0:f.map((s,m)=>{let p=u.find(x=>x.currentExercise==l.currentExercise);return e.jsx(d,{mx:1,height:"66px",width:"100px",display:"flex",flexDirection:"row",alignItems:"center",position:"relative",overflowY:"auto",onClick:()=>l.setCurrent(m),children:e.jsxs(d,{position:"relative",children:[p!=null&&p.progress?e.jsx(d,{position:"absolute",borderRadius:1,height:"100%",bgcolor:"rgba(255,255,255,0.7)",width:"100%",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",children:e.jsx(Rt,{value:p==null?void 0:p.progress,size:40})}):"",l.currentExercise==m&&!p?e.jsx(T,{style:{position:"absolute",top:-16,right:-16,zIndex:100},onClick:x=>{x.stopPropagation(),l.removeVideo(m)},children:e.jsx(Bt,{})}):"",e.jsx(d,{borderRadius:1,border:2,borderColor:l.currentExercise==m?"#fff":"rgba(255, 255, 255, 0)",position:"relative",overflow:"hidden",bgcolor:"none",children:S((s==null?void 0:s.name)||s)=="video"?e.jsxs(d,{borderRadius:1,overflow:"hidden",height:66,width:100,children:[typeof s.file=="string"?e.jsx(Wt,{link:s}):e.jsx(Nt,{component:Pt,fileName:s.name,url:URL.createObjectURL(s),loop:!0,controls:!1,autoPlay:!0,responsive:!0,playsinline:!0,playing:!1,width:"100%",height:"100%",style:{display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"8px",width:"100%",height:"100%","& video":{borderRadius:"20px"}}}),e.jsx("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:0,height:"100%",width:"100%",display:"flex",justifyContent:"flex-start",alignItems:"flex-start",padding:8,background:"rgba(0,0,0,0.15)"},children:e.jsx(D,{icon:"majesticons:video",color:"common.white",width:18,height:18})})]}):e.jsxs(d,{borderRadius:1,overflow:"hidden",height:66,width:100,children:[e.jsx(R,{variant:"rounded",style:{width:"100%",height:"100%",objectFit:"cover"},src:typeof(s==null?void 0:s.file)=="string"?s.file:URL.createObjectURL(s)}),e.jsx("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:0,height:"100%",width:"100%",display:"flex",justifyContent:"flex-start",alignItems:"flex-start",padding:8,background:"rgba(0,0,0,0.15)"},children:e.jsx(D,{icon:"bi:image-fill",color:"common.white",width:18,height:18})})]})})]})})})]}),e.jsx(Vt,{placeholder:"Write exercise name here",fullWidth:!0,inputRef:a,defaultValue:(y=l.videos[l.currentExercise])==null?void 0:y.title,onBlur:s=>{l.updateMediaTitle(s.target.value,l.currentExercise)},sx:{py:1,px:1.5,mb:3,fontSize:16,color:"common.white",border:"1px solid #fff",boxShadow:"0px 4px 4px rgba(0, 0, 0, 0.25)",borderRadius:1,background:"rgba(43, 64, 87, 0.5)"}}),e.jsx("br",{})]})},Nt=h.memo(l=>{let u=l.component;return e.jsx(u,{...l})},(l,u)=>l.fileName==u.fileName),Wt=l=>{const[u,a]=h.useState("");return h.useEffect(()=>{l.link.type=="youtube"?a(Dt(l.link.file)):a(Ut(l.link))},[l.link]),e.jsx(R,{onClick:l.onClick,variant:"rounded",style:{width:"100%",height:"100%",objectFit:"cover",backgroundColor:"#fafafa"},src:u||"/images/instructor/exerciseImage.png"})};export{$e as default};
