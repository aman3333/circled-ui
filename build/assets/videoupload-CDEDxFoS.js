import{y as Ae,w as De,r as je,j as P,bg as qe}from"./index-tWVfh1a_.js";var ge={exports:{}};(function(n,r){(function(e,t){n.exports=t(e)})(typeof self<"u"?self:typeof window<"u"?window:typeof globalThis<"u"?globalThis:Ae,function(e){e=e||{};var t=e.Base64,o="2.6.4",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=function(u){for(var c={},p=0,v=u.length;p<v;p++)c[u.charAt(p)]=p;return c}(i),a=String.fromCharCode,f=function(u){if(u.length<2){var c=u.charCodeAt(0);return c<128?u:c<2048?a(192|c>>>6)+a(128|c&63):a(224|c>>>12&15)+a(128|c>>>6&63)+a(128|c&63)}else{var c=65536+(u.charCodeAt(0)-55296)*1024+(u.charCodeAt(1)-56320);return a(240|c>>>18&7)+a(128|c>>>12&63)+a(128|c>>>6&63)+a(128|c&63)}},h=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,d=function(u){return u.replace(h,f)},l=function(u){var c=[0,2,1][u.length%3],p=u.charCodeAt(0)<<16|(u.length>1?u.charCodeAt(1):0)<<8|(u.length>2?u.charCodeAt(2):0),v=[i.charAt(p>>>18),i.charAt(p>>>12&63),c>=2?"=":i.charAt(p>>>6&63),c>=1?"=":i.charAt(p&63)];return v.join("")},_=e.btoa&&typeof e.btoa=="function"?function(u){return e.btoa(u)}:function(u){if(u.match(/[^\x00-\xFF]/))throw new RangeError("The string contains invalid characters.");return u.replace(/[\s\S]{1,3}/g,l)},k=function(u){return _(d(String(u)))},E=function(u){return u.replace(/[+\/]/g,function(c){return c=="+"?"-":"_"}).replace(/=/g,"")},g=function(u,c){return c?E(k(u)):k(u)},T=function(u){return g(u,!0)},b;e.Uint8Array&&(b=function(u,c){for(var p="",v=0,C=u.length;v<C;v+=3){var Ce=u[v],re=u[v+1],ne=u[v+2],A=Ce<<16|re<<8|ne;p+=i.charAt(A>>>18)+i.charAt(A>>>12&63)+(typeof re<"u"?i.charAt(A>>>6&63):"=")+(typeof ne<"u"?i.charAt(A&63):"=")}return c?E(p):p});var I=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,U=function(u){switch(u.length){case 4:var c=(7&u.charCodeAt(0))<<18|(63&u.charCodeAt(1))<<12|(63&u.charCodeAt(2))<<6|63&u.charCodeAt(3),p=c-65536;return a((p>>>10)+55296)+a((p&1023)+56320);case 3:return a((15&u.charCodeAt(0))<<12|(63&u.charCodeAt(1))<<6|63&u.charCodeAt(2));default:return a((31&u.charCodeAt(0))<<6|63&u.charCodeAt(1))}},J=function(u){return u.replace(I,U)},xe=function(u){var c=u.length,p=c%4,v=(c>0?s[u.charAt(0)]<<18:0)|(c>1?s[u.charAt(1)]<<12:0)|(c>2?s[u.charAt(2)]<<6:0)|(c>3?s[u.charAt(3)]:0),C=[a(v>>>16),a(v>>>8&255),a(v&255)];return C.length-=[0,0,2,1][p],C.join("")},Q=e.atob&&typeof e.atob=="function"?function(u){return e.atob(u)}:function(u){return u.replace(/\S{1,4}/g,xe)},Y=function(u){return Q(String(u).replace(/[^A-Za-z0-9\+\/]/g,""))},ke=function(u){return J(Q(u))},ee=function(u){return String(u).replace(/[-_]/g,function(c){return c=="-"?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,"")},L=function(u){return ke(ee(u))},te;e.Uint8Array&&(te=function(u){return Uint8Array.from(Y(ee(u)),function(c){return c.charCodeAt(0)})});var Ee=function(){var u=e.Base64;return e.Base64=t,u};if(e.Base64={VERSION:o,atob:Y,btoa:_,fromBase64:L,toBase64:g,utob:d,encode:g,encodeURI:T,btou:J,decode:L,noConflict:Ee,fromUint8Array:b,toUint8Array:te},typeof Object.defineProperty=="function"){var $=function(u){return{value:u,enumerable:!1,writable:!0,configurable:!0}};e.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",$(function(){return L(this)})),Object.defineProperty(String.prototype,"toBase64",$(function(u){return g(this,u)})),Object.defineProperty(String.prototype,"toBase64URI",$(function(){return g(this,!0)}))}}return e.Meteor&&(Base64=e.Base64),n.exports&&(n.exports.Base64=e.Base64),{Base64:e.Base64}})})(ge);var ze=ge.exports,Fe=function(r,e){if(e=e.split(":")[0],r=+r,!r)return!1;switch(e){case"http":case"ws":return r!==80;case"https":case"wss":return r!==443;case"ftp":return r!==21;case"gopher":return r!==70;case"file":return!1}return r!==0},V={},He=Object.prototype.hasOwnProperty,Be;function oe(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch{return null}}function ie(n){try{return encodeURIComponent(n)}catch{return null}}function Te(n){for(var r=/([^=?#&]+)=?([^&]*)/g,e={},t;t=r.exec(n);){var o=oe(t[1]),i=oe(t[2]);o===null||i===null||o in e||(e[o]=i)}return e}function Ie(n,r){r=r||"";var e=[],t,o;typeof r!="string"&&(r="?");for(o in n)if(He.call(n,o)){if(t=n[o],!t&&(t===null||t===Be||isNaN(t))&&(t=""),o=ie(o),t=ie(t),o===null||t===null)continue;e.push(o+"="+t)}return e.length?r+e.join("&"):""}V.stringify=Ie;V.parse=Te;var be=Fe,B=V,Le=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,Ue=/[\n\r\t]/g,$e=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,we=/:\d+$/,Ne=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,Me=/^[a-zA-Z]:/;function Z(n){return(n||"").toString().replace(Le,"")}var N=[["#","hash"],["?","query"],function(r,e){return y(e.protocol)?r.replace(/\\/g,"/"):r},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],ae={hash:1,query:1};function Se(n){var r;typeof window<"u"?r=window:typeof globalThis<"u"?r=globalThis:typeof self<"u"?r=self:r={};var e=r.location||{};n=n||e;var t={},o=typeof n,i;if(n.protocol==="blob:")t=new m(unescape(n.pathname),{});else if(o==="string"){t=new m(n,{});for(i in ae)delete t[i]}else if(o==="object"){for(i in n)i in ae||(t[i]=n[i]);t.slashes===void 0&&(t.slashes=$e.test(n.href))}return t}function y(n){return n==="file:"||n==="ftp:"||n==="http:"||n==="https:"||n==="ws:"||n==="wss:"}function Re(n,r){n=Z(n),n=n.replace(Ue,""),r=r||{};var e=Ne.exec(n),t=e[1]?e[1].toLowerCase():"",o=!!e[2],i=!!e[3],s=0,a;return o?i?(a=e[2]+e[3]+e[4],s=e[2].length+e[3].length):(a=e[2]+e[4],s=e[2].length):i?(a=e[3]+e[4],s=e[3].length):a=e[4],t==="file:"?s>=2&&(a=a.slice(2)):y(t)?a=e[4]:t?o&&(a=a.slice(2)):s>=2&&y(r.protocol)&&(a=e[4]),{protocol:t,slashes:o||y(t),slashesCount:s,rest:a}}function Ke(n,r){if(n==="")return r;for(var e=(r||"/").split("/").slice(0,-1).concat(n.split("/")),t=e.length,o=e[t-1],i=!1,s=0;t--;)e[t]==="."?e.splice(t,1):e[t]===".."?(e.splice(t,1),s++):s&&(t===0&&(i=!0),e.splice(t,1),s--);return i&&e.unshift(""),(o==="."||o==="..")&&e.push(""),e.join("/")}function m(n,r,e){if(n=Z(n),n=n.replace(Ue,""),!(this instanceof m))return new m(n,r,e);var t,o,i,s,a,f,h=N.slice(),d=typeof r,l=this,_=0;for(d!=="object"&&d!=="string"&&(e=r,r=null),e&&typeof e!="function"&&(e=B.parse),r=Se(r),o=Re(n||"",r),t=!o.protocol&&!o.slashes,l.slashes=o.slashes||t&&r.slashes,l.protocol=o.protocol||r.protocol||"",n=o.rest,(o.protocol==="file:"&&(o.slashesCount!==2||Me.test(n))||!o.slashes&&(o.protocol||o.slashesCount<2||!y(l.protocol)))&&(h[3]=[/(.*)/,"pathname"]);_<h.length;_++){if(s=h[_],typeof s=="function"){n=s(n,l);continue}i=s[0],f=s[1],i!==i?l[f]=n:typeof i=="string"?(a=i==="@"?n.lastIndexOf(i):n.indexOf(i),~a&&(typeof s[2]=="number"?(l[f]=n.slice(0,a),n=n.slice(a+s[2])):(l[f]=n.slice(a),n=n.slice(0,a)))):(a=i.exec(n))&&(l[f]=a[1],n=n.slice(0,a.index)),l[f]=l[f]||t&&s[3]&&r[f]||"",s[4]&&(l[f]=l[f].toLowerCase())}e&&(l.query=e(l.query)),t&&r.slashes&&l.pathname.charAt(0)!=="/"&&(l.pathname!==""||r.pathname!=="")&&(l.pathname=Ke(l.pathname,r.pathname)),l.pathname.charAt(0)!=="/"&&y(l.protocol)&&(l.pathname="/"+l.pathname),be(l.port,l.protocol)||(l.host=l.hostname,l.port=""),l.username=l.password="",l.auth&&(a=l.auth.indexOf(":"),~a?(l.username=l.auth.slice(0,a),l.username=encodeURIComponent(decodeURIComponent(l.username)),l.password=l.auth.slice(a+1),l.password=encodeURIComponent(decodeURIComponent(l.password))):l.username=encodeURIComponent(decodeURIComponent(l.auth)),l.auth=l.password?l.username+":"+l.password:l.username),l.origin=l.protocol!=="file:"&&y(l.protocol)&&l.host?l.protocol+"//"+l.host:"null",l.href=l.toString()}function Xe(n,r,e){var t=this;switch(n){case"query":typeof r=="string"&&r.length&&(r=(e||B.parse)(r)),t[n]=r;break;case"port":t[n]=r,be(r,t.protocol)?r&&(t.host=t.hostname+":"+r):(t.host=t.hostname,t[n]="");break;case"hostname":t[n]=r,t.port&&(r+=":"+t.port),t.host=r;break;case"host":t[n]=r,we.test(r)?(r=r.split(":"),t.port=r.pop(),t.hostname=r.join(":")):(t.hostname=r,t.port="");break;case"protocol":t.protocol=r.toLowerCase(),t.slashes=!e;break;case"pathname":case"hash":if(r){var o=n==="pathname"?"/":"#";t[n]=r.charAt(0)!==o?o+r:r}else t[n]=r;break;case"username":case"password":t[n]=encodeURIComponent(r);break;case"auth":var i=r.indexOf(":");~i?(t.username=r.slice(0,i),t.username=encodeURIComponent(decodeURIComponent(t.username)),t.password=r.slice(i+1),t.password=encodeURIComponent(decodeURIComponent(t.password))):t.username=encodeURIComponent(decodeURIComponent(r))}for(var s=0;s<N.length;s++){var a=N[s];a[4]&&(t[a[1]]=t[a[1]].toLowerCase())}return t.auth=t.password?t.username+":"+t.password:t.username,t.origin=t.protocol!=="file:"&&y(t.protocol)&&t.host?t.protocol+"//"+t.host:"null",t.href=t.toString(),t}function Ve(n){(!n||typeof n!="function")&&(n=B.stringify);var r,e=this,t=e.host,o=e.protocol;o&&o.charAt(o.length-1)!==":"&&(o+=":");var i=o+(e.protocol&&e.slashes||y(e.protocol)?"//":"");return e.username?(i+=e.username,e.password&&(i+=":"+e.password),i+="@"):e.password?(i+=":"+e.password,i+="@"):e.protocol!=="file:"&&y(e.protocol)&&!t&&e.pathname!=="/"&&(i+="@"),(t[t.length-1]===":"||we.test(e.hostname)&&!e.port)&&(t+=":"),i+=t+e.pathname,r=typeof e.query=="object"?n(e.query):e.query,r&&(i+=r.charAt(0)!=="?"?"?"+r:r),e.hash&&(i+=e.hash),i}m.prototype={set:Xe,toString:Ve};m.extractProtocol=Re;m.location=Se;m.trimLeft=Z;m.qs=B;var Ze=m;const We=De(Ze);function j(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?j=function(e){return typeof e}:j=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(n)}function Ge(n,r,e){return n}function Je(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function Qe(n,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(r&&r.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),r&&O(n,r)}function Ye(n){var r=Pe();return function(){var t=x(n),o;if(r){var i=x(this).constructor;o=Reflect.construct(t,arguments,i)}else o=t.apply(this,arguments);return et(this,o)}}function et(n,r){return r&&(j(r)==="object"||typeof r=="function")?r:tt(n)}function tt(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function M(n){var r=typeof Map=="function"?new Map:void 0;return M=function(t){if(t===null||!rt(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r<"u"){if(r.has(t))return r.get(t);r.set(t,o)}function o(){return q(t,arguments,x(this).constructor)}return o.prototype=Object.create(t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),O(o,t)},M(n)}function q(n,r,e){return Pe()?q=Reflect.construct:q=function(o,i,s){var a=[null];a.push.apply(a,i);var f=Function.bind.apply(o,a),h=new f;return s&&O(h,s.prototype),h},q.apply(null,arguments)}function Pe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function rt(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function O(n,r){return O=Object.setPrototypeOf||function(t,o){return t.__proto__=o,t},O(n,r)}function x(n){return x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},x(n)}var D=function(n){Qe(e,n);var r=Ye(e);function e(t){var o,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(Je(this,e),o=r.call(this,t),o.originalRequest=s,o.originalResponse=a,o.causingError=i,i!=null&&(t+=", caused by ".concat(i.toString())),s!=null){var f=s.getHeader("X-Request-ID")||"n/a",h=s.getMethod(),d=s.getURL(),l=a?a.getStatus():"n/a",_=a?a.getBody()||"":"n/a";t+=", originated from request (method: ".concat(h,", url: ").concat(d,", response code: ").concat(l,", response text: ").concat(_,", request id: ").concat(f,")")}return o.message=t,o}return Ge(e)}(M(Error));function nt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var r=Math.random()*16|0,e=n=="x"?r:r&3|8;return e.toString(16)})}function se(n,r){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);r&&(t=t.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),e.push.apply(e,t)}return e}function w(n){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?se(Object(e),!0).forEach(function(t){ot(n,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):se(Object(e)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))})}return n}function ot(n,r,e){return r in n?Object.defineProperty(n,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[r]=e,n}function it(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function ue(n,r){for(var e=0;e<r.length;e++){var t=r[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function at(n,r,e){return r&&ue(n.prototype,r),e&&ue(n,e),n}var st={endpoint:null,uploadUrl:null,metadata:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,_onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:null,chunkSize:1/0,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null},F=function(){function n(r,e){it(this,n),"resume"in e&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=e,this.options.chunkSize=+this.options.chunkSize,this._urlStorage=this.options.urlStorage,this.file=r,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}return at(n,[{key:"findPreviousUploads",value:function(){var e=this;return this.options.fingerprint(this.file,this.options).then(function(t){return e._urlStorage.findUploadsByFingerprint(t)})}},{key:"resumeFromPreviousUpload",value:function(e){this.url=e.uploadUrl||null,this._parallelUploadUrls=e.parallelUploadUrls||null,this._urlStorageKey=e.urlStorageKey}},{key:"start",value:function(){var e=this,t=this.file;if(!t){this._emitError(new Error("tus: no file or stream to upload provided"));return}if(!this.options.endpoint&&!this.options.uploadUrl){this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));return}var o=this.options.retryDelays;if(o!=null&&Object.prototype.toString.call(o)!=="[object Array]"){this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"));return}this.options.parallelUploads>1&&["uploadUrl","uploadSize","uploadLengthDeferred"].forEach(function(i){e.options[i]&&e._emitError(new Error("tus: cannot use the ".concat(i," option when parallelUploads is enabled")))}),this.options.fingerprint(t,this.options).then(function(i){return e._fingerprint=i,e._source?e._source:e.options.fileReader.openFile(t,e.options.chunkSize)}).then(function(i){e._source=i,e.options.parallelUploads>1||e._parallelUploadUrls!=null?e._startParallelUpload():e._startSingleUpload()}).catch(function(i){e._emitError(i)})}},{key:"_startParallelUpload",value:function(){var e=this,t=this._size=this._source.size,o=0;this._parallelUploads=[];var i=this._parallelUploadUrls!=null?this._parallelUploadUrls.length:this.options.parallelUploads,s=lt(this._source.size,i,this._parallelUploadUrls);this._parallelUploadUrls=new Array(s.length);var a=s.map(function(h,d){var l=0;return e._source.slice(h.start,h.end).then(function(_){var k=_.value;return new Promise(function(E,g){var T=w(w({},e.options),{},{uploadUrl:h.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,metadata:{},headers:w(w({},e.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:E,onError:g,onProgress:function(U){o=o-l+U,l=U,e._emitProgress(o,t)},_onUploadUrlAvailable:function(){e._parallelUploadUrls[d]=b.url,e._parallelUploadUrls.filter(function(U){return!!U}).length===s.length&&e._saveUploadInUrlStorage()}}),b=new n(k,T);b.start(),e._parallelUploads.push(b)})})}),f;Promise.all(a).then(function(){f=e._openRequest("POST",e.options.endpoint),f.setHeader("Upload-Concat","final;".concat(e._parallelUploadUrls.join(" ")));var h=le(e.options.metadata);return h!==""&&f.setHeader("Upload-Metadata",h),e._sendRequest(f,null)}).then(function(h){if(!S(h.getStatus(),200)){e._emitHttpError(f,h,"tus: unexpected response while creating upload");return}var d=h.getHeader("Location");if(d==null){e._emitHttpError(f,h,"tus: invalid or missing Location header");return}e.url=pe(e.options.endpoint,d),"Created upload at ".concat(e.url),e._emitSuccess()}).catch(function(h){e._emitError(h)})}},{key:"_startSingleUpload",value:function(){if(this.options.uploadLengthDeferred)this._size=null;else if(this.options.uploadSize!=null){if(this._size=+this.options.uploadSize,isNaN(this._size)){this._emitError(new Error("tus: cannot convert `uploadSize` option into a number"));return}}else if(this._size=this._source.size,this._size==null){this._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));return}if(this._aborted=!1,this.url!=null){"Resuming upload from previous URL: ".concat(this.url),this._resumeUpload();return}if(this.options.uploadUrl!=null){"Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,this._resumeUpload();return}this._createUpload()}},{key:"abort",value:function(e){var t=this;if(arguments.length>1&&typeof arguments[1]=="function")throw new Error("tus: the abort function does not accept a callback since v2 anymore; please use the returned Promise instead");return this._parallelUploads!=null&&this._parallelUploads.forEach(function(o){o.abort(e)}),this._req!==null&&(this._req.abort(),this._source.close()),this._aborted=!0,this._retryTimeout!=null&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),!e||this.url==null?Promise.resolve():n.terminate(this.url,this.options).then(function(){return t._removeFromUrlStorage()})}},{key:"_emitHttpError",value:function(e,t,o,i){this._emitError(new D(o,i,e,t))}},{key:"_emitError",value:function(e){var t=this;if(!this._aborted){if(this.options.retryDelays!=null){var o=this._offset!=null&&this._offset>this._offsetBeforeRetry;if(o&&(this._retryAttempt=0),he(e,this._retryAttempt,this.options)){var i=this.options.retryDelays[this._retryAttempt++];this._offsetBeforeRetry=this._offset,this._retryTimeout=setTimeout(function(){t.start()},i);return}}if(typeof this.options.onError=="function")this.options.onError(e);else throw e}}},{key:"_emitSuccess",value:function(){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),typeof this.options.onSuccess=="function"&&this.options.onSuccess()}},{key:"_emitProgress",value:function(e,t){typeof this.options.onProgress=="function"&&this.options.onProgress(e,t)}},{key:"_emitChunkComplete",value:function(e,t,o){typeof this.options.onChunkComplete=="function"&&this.options.onChunkComplete(e,t,o)}},{key:"_createUpload",value:function(){var e=this;if(!this.options.endpoint){this._emitError(new Error("tus: unable to create upload because no endpoint is provided"));return}var t=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?t.setHeader("Upload-Defer-Length",1):t.setHeader("Upload-Length",this._size);var o=le(this.options.metadata);o!==""&&t.setHeader("Upload-Metadata",o);var i;this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,i=this._addChunkToRequest(t)):i=this._sendRequest(t,null),i.then(function(s){if(!S(s.getStatus(),200)){e._emitHttpError(t,s,"tus: unexpected response while creating upload");return}var a=s.getHeader("Location");if(a==null){e._emitHttpError(t,s,"tus: invalid or missing Location header");return}if(e.url=pe(e.options.endpoint,a),"Created upload at ".concat(e.url),typeof e.options._onUploadUrlAvailable=="function"&&e.options._onUploadUrlAvailable(),e._size===0){e._emitSuccess(),e._source.close();return}e._saveUploadInUrlStorage(),e.options.uploadDataDuringCreation?e._handleUploadResponse(t,s):(e._offset=0,e._performUpload())}).catch(function(s){e._emitHttpError(t,null,"tus: failed to create upload",s)})}},{key:"_resumeUpload",value:function(){var e=this,t=this._openRequest("HEAD",this.url),o=this._sendRequest(t,null);o.then(function(i){var s=i.getStatus();if(!S(s,200)){if(S(s,400)&&e._removeFromUrlStorage(),s===423){e._emitHttpError(t,i,"tus: upload is currently locked; retry later");return}if(!e.options.endpoint){e._emitHttpError(t,i,"tus: unable to resume upload (new upload cannot be created without an endpoint)");return}e.url=null,e._createUpload();return}var a=parseInt(i.getHeader("Upload-Offset"),10);if(isNaN(a)){e._emitHttpError(t,i,"tus: invalid or missing offset value");return}var f=parseInt(i.getHeader("Upload-Length"),10);if(isNaN(f)&&!e.options.uploadLengthDeferred){e._emitHttpError(t,i,"tus: invalid or missing length value");return}if(typeof e.options._onUploadUrlAvailable=="function"&&e.options._onUploadUrlAvailable(),a===f){e._emitProgress(f,f),e._emitSuccess();return}e._offset=a,e._performUpload()}).catch(function(i){e._emitHttpError(t,null,"tus: failed to resume upload",i)})}},{key:"_performUpload",value:function(){var e=this;if(!this._aborted){var t;this.options.overridePatchMethod?(t=this._openRequest("POST",this.url),t.setHeader("X-HTTP-Method-Override","PATCH")):t=this._openRequest("PATCH",this.url),t.setHeader("Upload-Offset",this._offset);var o=this._addChunkToRequest(t);o.then(function(i){if(!S(i.getStatus(),200)){e._emitHttpError(t,i,"tus: unexpected response while uploading chunk");return}e._handleUploadResponse(t,i)}).catch(function(i){e._aborted||e._emitHttpError(t,null,"tus: failed to upload chunk at offset ".concat(e._offset),i)})}}},{key:"_addChunkToRequest",value:function(e){var t=this,o=this._offset,i=this._offset+this.options.chunkSize;return e.setProgressHandler(function(s){t._emitProgress(o+s,t._size)}),e.setHeader("Content-Type","application/offset+octet-stream"),(i===1/0||i>this._size)&&!this.options.uploadLengthDeferred&&(i=this._size),this._source.slice(o,i).then(function(s){var a=s.value,f=s.done;return t.options.uploadLengthDeferred&&f&&(t._size=t._offset+(a&&a.size?a.size:0),e.setHeader("Upload-Length",t._size)),a===null?t._sendRequest(e):(t._emitProgress(t._offset,t._size),t._sendRequest(e,a))})}},{key:"_handleUploadResponse",value:function(e,t){var o=parseInt(t.getHeader("Upload-Offset"),10);if(isNaN(o)){this._emitHttpError(e,t,"tus: invalid or missing offset value");return}if(this._emitProgress(o,this._size),this._emitChunkComplete(o-this._offset,o,this._size),this._offset=o,o==this._size){this._emitSuccess(),this._source.close();return}this._performUpload()}},{key:"_openRequest",value:function(e,t){var o=fe(e,t,this.options);return this._req=o,o}},{key:"_removeFromUrlStorage",value:function(){var e=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch(function(t){e._emitError(t)}),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var e=this;if(!(!this.options.storeFingerprintForResuming||!this._fingerprint)){var t={size:this._size,metadata:this.options.metadata,creationTime:new Date().toString()};this._parallelUploads?t.parallelUploadUrls=this._parallelUploadUrls:t.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,t).then(function(o){return e._urlStorageKey=o}).catch(function(o){e._emitError(o)})}}},{key:"_sendRequest",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return ce(e,t,this.options)}}],[{key:"terminate",value:function(e,t){if(arguments.length>1&&typeof arguments[arguments.length-1]=="function")throw new Error("tus: the terminate function does not accept a callback since v2 anymore; please use the returned Promise instead");t===void 0&&(t={});var o=fe("DELETE",e,t);return ce(o,null,t).then(function(i){if(i.getStatus()!==204)throw new D("tus: unexpected response while terminating upload",null,o,i)}).catch(function(i){if(i instanceof D||(i=new D("tus: failed to terminate upload",i,o,null)),!he(i,0,t))throw i;var s=t.retryDelays[0],a=t.retryDelays.slice(1),f=w(w({},t),{},{retryDelays:a});return new Promise(function(h){return setTimeout(h,s)}).then(function(){return n.terminate(e,f)})})}}]),n}();function le(n){var r=[];for(var e in n)r.push("".concat(e," ").concat(ze.Base64.encode(n[e])));return r.join(",")}function S(n,r){return n>=r&&n<r+100}function fe(n,r,e){var t=e.httpStack.createRequest(n,r);t.setHeader("Tus-Resumable","1.0.0");var o=e.headers||{};for(var i in o)t.setHeader(i,o[i]);if(e.addRequestId){var s=nt();t.setHeader("X-Request-ID",s)}return t}function ce(n,r,e){var t=typeof e.onBeforeRequest=="function"?Promise.resolve(e.onBeforeRequest(n)):Promise.resolve();return t.then(function(){return n.send(r).then(function(o){var i=typeof e.onAfterResponse=="function"?Promise.resolve(e.onAfterResponse(n,o)):Promise.resolve();return i.then(function(){return o})})})}function ut(){var n=!0;return typeof window<"u"&&"navigator"in window&&window.navigator.onLine===!1&&(n=!1),n}function he(n,r,e){if(e.retryDelays==null||r>=e.retryDelays.length||n.originalRequest==null)return!1;if(e&&typeof e.onShouldRetry=="function")return e.onShouldRetry(n,r,e);var t=n.originalResponse?n.originalResponse.getStatus():0;return(!S(t,400)||t===409||t===423)&&ut()}function pe(n,r){return new We(r,n).toString()}function lt(n,r,e){for(var t=Math.floor(n/r),o=[],i=0;i<r;i++)o.push({start:t*i,end:t*(i+1)});return o[r-1].end=n,e&&o.forEach(function(s,a){s.uploadUrl=e[a]||null}),o}F.defaultOptions=st;function ft(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function ct(n,r){for(var e=0;e<r.length;e++){var t=r[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function ht(n,r,e){return r&&ct(n.prototype,r),n}var pt=function(){function n(){ft(this,n)}return ht(n,[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(e){return Promise.resolve([])}},{key:"removeUpload",value:function(e){return Promise.resolve()}},{key:"addUpload",value:function(e,t){return Promise.resolve(null)}}]),n}();function dt(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function vt(n,r){for(var e=0;e<r.length;e++){var t=r[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function _t(n,r,e){return r&&vt(n.prototype,r),n}var K=!1;try{K="localStorage"in window;var de="tusSupport";localStorage.setItem(de,localStorage.getItem(de))}catch(n){if(n.code===n.SECURITY_ERR||n.code===n.QUOTA_EXCEEDED_ERR)K=!1;else throw n}var yt=K,mt=function(){function n(){dt(this,n)}return _t(n,[{key:"findAllUploads",value:function(){var e=this._findEntries("tus::");return Promise.resolve(e)}},{key:"findUploadsByFingerprint",value:function(e){var t=this._findEntries("tus::".concat(e,"::"));return Promise.resolve(t)}},{key:"removeUpload",value:function(e){return localStorage.removeItem(e),Promise.resolve()}},{key:"addUpload",value:function(e,t){var o=Math.round(Math.random()*1e12),i="tus::".concat(e,"::").concat(o);return localStorage.setItem(i,JSON.stringify(t)),Promise.resolve(i)}},{key:"_findEntries",value:function(e){for(var t=[],o=0;o<localStorage.length;o++){var i=localStorage.key(o);if(i.indexOf(e)===0)try{var s=JSON.parse(localStorage.getItem(i));s.urlStorageKey=i,t.push(s)}catch{}}return t}}]),n}();function W(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function gt(n,r){for(var e=0;e<r.length;e++){var t=r[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function G(n,r,e){return r&&gt(n.prototype,r),n}var bt=function(){function n(){W(this,n)}return G(n,[{key:"createRequest",value:function(e,t){return new Ut(e,t)}},{key:"getName",value:function(){return"XHRHttpStack"}}]),n}(),Ut=function(){function n(r,e){W(this,n),this._xhr=new XMLHttpRequest,this._xhr.open(r,e,!0),this._method=r,this._url=e,this._headers={}}return G(n,[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(e,t){this._xhr.setRequestHeader(e,t),this._headers[e]=t}},{key:"getHeader",value:function(e){return this._headers[e]}},{key:"setProgressHandler",value:function(e){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(t){t.lengthComputable&&e(t.loaded)})}},{key:"send",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return new Promise(function(o,i){e._xhr.onload=function(){o(new wt(e._xhr))},e._xhr.onerror=function(s){i(s)},e._xhr.send(t)})}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}]),n}(),wt=function(){function n(r){W(this,n),this._xhr=r}return G(n,[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(e){return this._xhr.getResponseHeader(e)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}]),n}(),Oe=function(){return typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative"};function St(n){return new Promise(function(r,e){var t=new XMLHttpRequest;t.responseType="blob",t.onload=function(){var o=t.response;r(o)},t.onerror=function(o){e(o)},t.open("GET",n),t.send()})}var Rt=function(){return typeof window<"u"&&(typeof window.PhoneGap<"u"||typeof window.Cordova<"u"||typeof window.cordova<"u")};function Pt(n){return new Promise(function(r,e){var t=new FileReader;t.onload=function(){var o=new Uint8Array(t.result);r({value:o})},t.onerror=function(o){e(o)},t.readAsArrayBuffer(n)})}function Ot(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function xt(n,r){for(var e=0;e<r.length;e++){var t=r[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function kt(n,r,e){return r&&xt(n.prototype,r),n}var ve=function(){function n(r){Ot(this,n),this._file=r,this.size=r.size}return kt(n,[{key:"slice",value:function(e,t){if(Rt())return Pt(this._file.slice(e,t));var o=this._file.slice(e,t);return Promise.resolve({value:o})}},{key:"close",value:function(){}}]),n}();function Et(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function Ct(n,r){for(var e=0;e<r.length;e++){var t=r[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function At(n,r,e){return r&&Ct(n.prototype,r),n}function _e(n){return n===void 0?0:n.size!==void 0?n.size:n.length}function Dt(n,r){if(n.concat)return n.concat(r);if(n instanceof Blob)return new Blob([n,r],{type:n.type});if(n.set){var e=new n.constructor(n.length+r.length);return e.set(n),e.set(r,n.length),e}throw new Error("Unknown data type")}var jt=function(){function n(r,e){Et(this,n),this._chunkSize=e,this._buffer=void 0,this._bufferOffset=0,this._reader=r,this._done=!1}return At(n,[{key:"slice",value:function(e,t){return e<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(e,t)}},{key:"_readUntilEnoughDataOrDone",value:function(e,t){var o=this,i=t<=this._bufferOffset+_e(this._buffer);if(this._done||i){var s=this._getDataFromBuffer(e,t),a=s==null?this._done:!1;return Promise.resolve({value:s,done:a})}return this._reader.read().then(function(f){var h=f.value,d=f.done;return d?o._done=!0:o._buffer===void 0?o._buffer=h:o._buffer=Dt(o._buffer,h),o._readUntilEnoughDataOrDone(e,t)})}},{key:"_getDataFromBuffer",value:function(e,t){e>this._bufferOffset&&(this._buffer=this._buffer.slice(e-this._bufferOffset),this._bufferOffset=e);var o=_e(this._buffer)===0;return this._done&&o?null:this._buffer.slice(0,t-e)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}]),n}();function qt(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function zt(n,r){for(var e=0;e<r.length;e++){var t=r[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function Ft(n,r,e){return r&&zt(n.prototype,r),n}var Ht=function(){function n(){qt(this,n)}return Ft(n,[{key:"openFile",value:function(e,t){return Oe()&&e&&typeof e.uri<"u"?St(e.uri).then(function(o){return new ve(o)}).catch(function(o){throw new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(o))}):typeof e.slice=="function"&&typeof e.size<"u"?Promise.resolve(new ve(e)):typeof e.read=="function"?(t=+t,isFinite(t)?Promise.resolve(new jt(e,t)):Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option"))):Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment"))}}]),n}();function Bt(n,r){return Oe()?Promise.resolve(Tt(n,r)):Promise.resolve(["tus-br",n.name,n.type,n.size,n.lastModified,r.endpoint].join("-"))}function Tt(n,r){var e=n.exif?It(JSON.stringify(n.exif)):"noexif";return["tus-rn",n.name||"noname",n.size||"nosize",e,r.endpoint].join("/")}function It(n){var r=0;if(n.length===0)return r;for(var e=0;e<n.length;e++){var t=n.charCodeAt(e);r=(r<<5)-r+t,r&=r}return r}function z(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?z=function(e){return typeof e}:z=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(n)}function Lt(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function $t(n,r){for(var e=0;e<r.length;e++){var t=r[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function Nt(n,r,e){return e&&$t(n,e),n}function Mt(n,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(r&&r.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),r&&X(n,r)}function X(n,r){return X=Object.setPrototypeOf||function(t,o){return t.__proto__=o,t},X(n,r)}function Kt(n){var r=Zt();return function(){var t=H(n),o;if(r){var i=H(this).constructor;o=Reflect.construct(t,arguments,i)}else o=t.apply(this,arguments);return Xt(this,o)}}function Xt(n,r){return r&&(z(r)==="object"||typeof r=="function")?r:Vt(n)}function Vt(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Zt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function H(n){return H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},H(n)}function ye(n,r){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);r&&(t=t.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),e.push.apply(e,t)}return e}function R(n){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?ye(Object(e),!0).forEach(function(t){Wt(n,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):ye(Object(e)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))})}return n}function Wt(n,r,e){return r in n?Object.defineProperty(n,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[r]=e,n}var me=R(R({},F.defaultOptions),{},{httpStack:new bt,fileReader:new Ht,urlStorage:yt?new mt:new pt,fingerprint:Bt}),Gt=function(n){Mt(e,n);var r=Kt(e);function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Lt(this,e),o=R(R({},me),o),r.call(this,t,o)}return Nt(e,null,[{key:"terminate",value:function(o,i,s){return i=R(R({},me),i),F.terminate(o,i,s)}}]),e}(F);function Qt(){const[n,r]=je.useState(""),e=async t=>{const o=t.target.files[0];o.name;const i=o.size.toString(),s=await qe({method:"get",url:`http://localhost:3001/api/misc/upload-video?fileSize=${i}`}),a=new Gt(o,{endPoint:"https://api.vimeo.com/me/videos",uploadUrl:s.data.data.upload.upload_link,retryDelays:[0,3e3,5e3,1e4,2e4],metadata:{filename:o.name,filetype:o.type},headers:{},onError:function(f){console.log("Failed because: "+f)},onSuccess:function(){r(a.url)}});a.start()};return P.jsxs(P.Fragment,{children:[P.jsx("div",{children:" Vimeo upload test"}),P.jsx("input",{onChange:e,type:"file"}),P.jsx("a",{href:n,children:"Video link"})]})}export{Qt as default};
